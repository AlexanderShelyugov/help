<!DOCTYPE html>
<html>
<head>
	<title>redirect...</title>
	<link rel="canonical" href="{{ .Permalink }}" />
	<meta name="robots" content="noindex" />
	<meta charset="utf-8" />
	<noscript>
		<meta http-equiv="refresh" content="0; url={{ .Permalink }}" />
	</noscript>
</head>
<body>

<script>
function getLanguage(lang) {
	lang = lang || getCookie('lang') || navigator.language || 'en';
	lang = lang.substring(0, 2);
	switch(lang) {
		case 'en':
		case 'ru':
			return lang;
		default:
			return 'en';
	}
}

function setCookie(cname, cvalue, exdays) {
	let d = new Date();
	d.setTime(d.getTime() + exdays * 86400000);
	document.cookie = cname + '=' + cvalue + ';expires=' + d.toUTCString() + ';path=/';
}

function getCookie(cname) {
	const name = cname + '=';
	const decodedCookie = decodeURIComponent(document.cookie);
	const ca = decodedCookie.split(';');
	for(let i = 0; i < ca.length; i++) {
		const c = ca[i];
		while(c.charAt(0) == ' ') c = c.substring(1);
		if(c.indexOf(name) == 0) return c.substring(name.length, c.length);
	}
	return '';
}
</script>

{{- if not $.Page }}

<script>
const params = new URLSearchParams(location.search);
const lang = getLanguage(params.get('lang'));
const next = params.get('next') || '/';
if(params.has('lang')) setCookie('lang', lang, 365);
location.replace('/' + lang + next);
</script>

{{- else }}

<script>
function shortAppAlias(lang, name) {
	location.replace('/' + getLanguage(lang) + '/a#' + name)
}

switch(location.pathname) {
	case '/pricing/':			shortAppAlias(null, 'pricing'); break;
	case '/profile/':			shortAppAlias(null, 'profile'); break;
	case '/help/':				shortAppAlias(null, 'help'); break;

	case '/en/pricing/':		shortAppAlias('en', 'pricing'); break;
	case '/en/profile/':		shortAppAlias('en', 'profile'); break;
	case '/en/help/':			shortAppAlias('en', 'help'); break;

	case '/ru/pricing/':		shortAppAlias('ru', 'pricing'); break;
	case '/ru/profile/':		shortAppAlias('ru', 'profile'); break;
	case '/ru/help/':			shortAppAlias('ru', 'help'); break;

	case '/astra-license/':		shortAppAlias(null, 'pricing'); break;

	default: 					location.replace('{{ .Permalink }}');
}
</script>

{{- end }}

</body>
</html>
